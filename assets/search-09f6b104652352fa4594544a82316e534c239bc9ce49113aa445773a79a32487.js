function resetState(){window.__state=DEFAULT_STATE}function devareState(){window.__state=undefined}function incrementIndex(){window.__state||resetState();var e=getIndex()+1===getResultNb();return window.__state.index=e?-1:(getIndex()+1)%getResultNb(),e}function decrementIndex(){window.__state||resetState(),window.__state.index=getIndex()-1,getIndex()<-1&&(window.__state.index=getResultNb()-1)}function getIndex(){return parseInt(window.__state.index,10)}function getResultNb(){return parseInt(window.__state.resultNb,10)}function setIndex(e){window.__state.index=e}function setResultNb(e){window.__state.resultNb=e}function moveSelected(e,t){if(getResultNb()){var r=!1;if(void 0===t){return;var n}else setIndex(t);var s=$("#search-li-"+getIndex());$(".search-li").removeClass("search-active"),$(".search-li").off("keydown"),s.addClass("search-active"),s.find("a").focus(),r&&$("document").css("cursor","none")}}function enableInput(){$("#search-input").keyup(function(e){if(sessionStorage.getItem("loading-data"))return void $("#search-loading").show();if($("#search-loading").is(":visible")&&$("#search-loading").hide(),38!==e.keyCode&&40!==e.keyCode){resetState();doSearch($("#search-input").val())}})}function enableSearchUI(){$(".tingle-modal-box").off("keyup"),$(".tingle-modal-box").keyup(moveSelected),$("#results-container li").click(function(e){var t=$(e.target);if(t.hasClass("search-tag")){var r=t.text();window.history.replaceState({},document.title,window.location.href.split("?")[0]+"?search="+r),doSearch(r),$("#search-input").val(r),$("#search-input").focus()}else{var n=t.closest("li").find(">:first-child").find(">:first-child").attr("href");n&&(window.location.href=n)}}),$(".search-li").on("mouseenter",function(e){var t=parseInt(e.target.id.split("-")[2]);isNaN(t)||moveSelected(e,t)}),$(".search-li").on("mouseleave",function(e){$(this).removeClass("search-active")}),document.onmousemove=function(){"none"===$("document").css("cursor")&&($("document").css("cursor","default"),$(".search-li").addClass("search-active-hover"))}}function matchAnd(e,t){for(var r in t){var n=t[r];if(-1===e.toLowerCase().indexOf(n.toLowerCase()))return!1}return!0}function mySearch(e){var t=[],r=e.toLowerCase(),n,s={tag:4,title:3,subtitle:2,excerpt:1};for(var a in window.store){n=!1;var o=window.store[a],i=o.title;i&&matchAnd(i,r.split(" "))&&(t.push({ref:a,score:s.title}),n=!0);var c=o.subtitle;c&&matchAnd(c,r.split(" "))&&(n?t[t.length-1].score+=2:(t.push({ref:a,score:s.subtitle}),n=!0));var l=o.tags.split(", ");for(var d in l)l[d]&&matchAnd(l[d],r.split(" "))&&(n?t[t.length-1].score+=3:(t.push({ref:a,score:s.tag}),n=!0));var u=o.excerpt;u&&matchAnd(u,r.split(" "))&&(n?t[t.length-1].score+=1:t.push({ref:a,score:s.excerpt}))}return resutls=t.sort(function(e,t){return t.score-e.score}),t}function doSearch(e){if(console.log("doSearch: ",e),$("#results-container").html(""),$.trim(e)){var t=mySearch(e);console.log("result",t),updateUrlParameter(e),showResults(t),$("#results-container li a, #results-container li p span").wrapInTag({tag:"strong",words:e.split(" ")})}else updateUrlParameter("")}function showResults(e){setResultNb(e.length);var t=0,r=[];for(var n in e){var s=e[n],a=s.ref,o=window.store[parseInt(a,10)],i=$(getTemplate(o,t));r.push(i),t++}for(const e of r)e.appendTo("#results-container");enableSearchUI()}function getTemplate(e,t){var r=$.trim(e.subtitle),n=$.trim(e.excerpt),s=$.trim(e.title),a=" ",o=e.date||"",i=r&&n?"<br/>":"",c=r||n?'<p id="search-p-'+t+'">':"",l=r||n?"</p>":"";return e.hasOwnProperty("tags")&&$.trim(e.tags)&&(a="<div>"+e.tags.split(", ").map(function(e,t){return'<span class="home-tag search-tag btn btn-outline" href="#">'+e+"</span>"}).reduce(function(e,t){return e+t})),'<li class="search-li" id="search-li-'+t+'">        <div class="search-item-header" id="search-div-'+t+'">            <a class="search-result-item-link" href="'+e.url+'" id="search-a-'+t+'"> '+s+'</a>            <span class="search-date"  id="search-date-'+t+'"> '+o+"</span>        </div>         "+c+'       <span class="search-subtitle"  id="search-subtitle-'+t+'">'+r+"</span>        "+i+'        <span class="search-excerpt" id="search-excerpt-'+t+'"> '+n+"</span>        "+l+a+"</li>"}function updateUrlParameter(e){window.history.pushState("","","?search="+encodeURIComponent(e))}function getCurrentURLQuery(e){var t=document.createElement("a");if(t.href=window.location.href,t.href.includes("?search=")){var r=decodeURIComponent(t.href.substring(t.href.indexOf("=")+1));$("#search-input").val(r),resetState(),doSearch(r),e.open()}}var DEFAULT_STATE={index:-1,resultNb:0},SEARCH_BASE='<div id="search-input-div"><input type="search" id="search-input" placeholder="What are you looking for?" autofocus autocomplete="off"></div><div id="search-container"><ul id="results-container"></ul></div><div id="search-loading" style="display:none">Loading blog data ... :)</div>';$("document").ready(function(){resetState();var e=new tingle.modal({footer:!1,stickyFooter:!1,closeMethods:["overlay","button","escape"],closeLabel:"Close",cssClass:["searchModal","custom-class-2"],closeLabel:"Close search",onClose:function(){window.history.replaceState({},document.title,window.location.href.split("?")[0]),$("#search-input").val(""),$("#results-container").html(""),$("document").off("keypress")},onOpen:function(){$("#search-input").focus()}});e.setContent(SEARCH_BASE),$(".search-link").click(function(t){return t.preventDefault(),e.open(),!1}),$.fn.wrapInTag=function(e){var t=e.tag||"strong",r=e.words||[],n=RegExp(r.join("|"),"gi"),s="<"+t+">$&</"+t+">";return this.html(function(){return $(this).text().replace(n,s)})},$(".home-tag").click(function(t){var r=$(t.target).html();updateUrlParameter(r),e.open(),doSearch(r),$("#search-input").val(r)});var t=!1,r;if(sessionStorage.getItem("search"))try{r=JSON.parse(sessionStorage.getItem("search")),new Date-new Date(r.date)>252e5&&(t=!0)}catch(e){t=!0}else t=!0;if(!t)try{window.store=r.store,getCurrentURLQuery(e),enableInput(),console.log("using local data")}catch(e){t=!0}t&&(sessionStorage.setItem("loading-data","true"),console.log("fetching data"),$.ajax({dataType:"json",url:"/search.json",context:document.body,success:function(t){window.store=[];for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];n.title&&window.store.push(n)}t=JSON.stringify({store:window.store,date:new Date}),sessionStorage.setItem("search",t),sessionStorage.removeItem("loading-data"),$("#search-input").val()&&$("#search-input").trigger("keyup"),getCurrentURLQuery(e),enableInput()}}))});